{% extends 'base.j2.html' %}
{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/record.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/progress.css') }}" />
{% endblock %}
{% block js %}
<script src="{{ url_for('static', filename='js/record.js') }}"></script>
<script>
  // Sync theme classes from parent window into iframe (same-origin)
  (function() {
    function applyThemeFrom(el) {
      try {
        var dstRoot = document.documentElement;
        if (!dstRoot || !el) return;
        // Remove existing theme-* classes from iframe root (<html>)
        dstRoot.className = (dstRoot.className || '').split(/\s+/).filter(function(c){ return !/^theme-/.test(c); }).join(' ');
        // Copy theme-* classes from source element
        var src = (el.className || '').split(/\s+/).filter(function(c){ return /^theme-/.test(c); });
        if (src.length) {
          dstRoot.className = (dstRoot.className ? dstRoot.className + ' ' : '') + src.join(' ');
        }
      } catch(_) {}
    }
    function syncOnce() {
      try {
        if (window.parent && window.parent !== window && window.parent.document) {
          applyThemeFrom(window.parent.document.documentElement);
        }
      } catch(_) {}
    }
    // Initial sync
    document.addEventListener('DOMContentLoaded', syncOnce);
    // Periodic sync in case theme toggles after load
    setInterval(syncOnce, 1000);
    // Listen to postMessage from parent if implemented in the future
    window.addEventListener('message', function(ev){
      if (!ev || !ev.data) return;
      if (ev.data && ev.data.type === 'theme:changed') {
        try {
          if (ev.data.className) {
            var dstRoot = document.documentElement;
            dstRoot.className = (dstRoot.className || '').split(/\s+/).filter(function(c){ return !/^theme-/.test(c); }).join(' ');
            dstRoot.className = (dstRoot.className ? dstRoot.className + ' ' : '') + ev.data.className;
          } else {
            syncOnce();
          }
        } catch(_) { syncOnce(); }
      }
    });
  })();
</script>
{% endblock %}
{% block main %}

<section class="record-page">
  {% if request.args.get('embed') != '1' %}
  <h1 class="record-page__title">Запись видео</h1>
  {% endif %}
  <div class="record-page__body">
    <div class="record-page__video">
      <video class="video" autoplay playsinline id="video"></video>
    </div>
    <div class="record-page__menu">
      <div class="record-page__pult">
        <button class="button" id="camera">Включить камеру</button>
        <button class="button" id="start">Начать запись</button>
        <button class="button" id="pause">Пауза</button>
        <button class="button" id="stop">Стоп</button>
      </div>
      <div class="record-page__settings">
        <div class="record-page__settings-time record-page__setting">
          <label class="record-page__setting-title">Длина записи:</label>
          <label class="record-page__setting-element" id="time">00:00:00</label>
        </div>
        <div class="record-page__settings-file-name record-page__setting">
          <label class="record-page__setting-title">Название файла:</label>
          <input
            class="record-page__setting-element"
            type="text"
            id="name"
            placeholder="Video"
            required
          />
        </div>
        <div class="record-page__settings-description record-page__setting">
          <label class="record-page__setting-title">Описание:</label>
          <textarea
            class="record-page__setting-element"
            id="desc"
            placeholder="Не обязательно..."
          ></textarea>
        </div>
        <button class="button" id="save">Сохранить</button>
        <input style="display: none" value="{{ did }}" id="did" />
        <input style="display: none" value="{{ sdid }}" id="sdid" />
        <div class="progress" id="uploadProgress" style="display:none;">
          <div class="progress-bar" id="uploadProgressBar" role="progressbar" style="width:0%"></div>
        </div>
        <div class="upload__container" style="display:none;">
          <span class="upload__status" id="uploadForm_Status"></span>
          <span id="uploadForm_Size"></span>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
