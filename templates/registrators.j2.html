{% extends "base.j2.html" %}

{% block title %}Регистраторы{% endblock %}

{% block main %}
<div class="container-fluid">
  <div class="subbar cat">
    <div class="subbar__group">
      <a class="topbtn" href="{{ url_for('categories_admin') }}">
        <i class="fas fa-folder"></i> Категории
      </a>
      <button class="topbtn active">
        <i class="fas fa-user-plus"></i> Регистраторы
      </button>
    </div>
  </div>

  <!-- Registrators nav + add button injected by JS -->
  <div class="subbar cat" id="registrators-tabs">
    <div class="subbar__group" id="registrators-nav"></div>
  </div>

  <!-- Permissions and file browser area -->
  <div id="permissions-content" style="display:none;">
    <div class="row">
      <div class="col-md-6">
        <div class="permissions-section">
          <h5><i class="fas fa-users"></i> Права групп</h5>
          <div class="permissions-table">
            <table class="table table-striped table-hover table-sm files-table files-page__table table-colored" role="table" aria-label="Таблица прав групп">
              <thead>
                <tr role="row">
                  <th scope="col">Группа</th>
                  <th scope="col" class="text-center" title="Доступ" data-bs-toggle="tooltip" aria-label="Доступ"><i class="bi bi-eye" aria-hidden="true"></i></th>
                </tr>
                <tr>
                  <th colspan="2">
                    <div class="searchbar">
                      <input id="groups-search" class="form-control form-control-sm" type="text" placeholder="Поиск группы..." autocomplete="off" />
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody id="groups-permissions"></tbody>
              <tfoot>
                <tr>
                  <td colspan="2">
                    <nav class="d-flex justify-content-center align-items-center">
                      <ul class="pagination pagination-sm mb-0 files-pagination" id="groups-pagination"></ul>
                    </nav>
                  </td>
                </tr>
              </tfoot>
            </table>
            <div class="mt-2 d-flex gap-2">
              <button id="save-groups" class="btn btn-success btn-sm" disabled>Сохранить</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="permissions-section">
          <h5><i class="fas fa-user"></i> Права пользователей</h5>
          <div class="permissions-table">
            <table class="table table-striped table-hover table-sm files-table files-page__table table-colored" role="table" aria-label="Таблица прав пользователей">
              <thead>
                <tr role="row">
                  <th scope="col">Пользователь</th>
                  <th scope="col" class="text-center" title="Доступ" data-bs-toggle="tooltip" aria-label="Доступ"><i class="bi bi-eye" aria-hidden="true"></i></th>
                </tr>
                <tr>
                  <th colspan="2">
                    <div class="searchbar">
                      <input id="users-search" class="form-control form-control-sm" type="text" placeholder="Поиск пользователя..." autocomplete="off" />
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody id="users-permissions"></tbody>
              <tfoot>
                <tr>
                  <td colspan="2">
                    <nav class="d-flex justify-content-center align-items-center">
                      <ul class="pagination pagination-sm mb-0 files-pagination" id="users-pagination"></ul>
                    </nav>
                  </td>
                </tr>
              </tfoot>
            </table>
            <div class="mt-2 d-flex gap-2">
              <button id="save-users" class="btn btn-success btn-sm" disabled>Сохранить</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Browser and import area -->
  <div class="card mt-3">
    <div class="card-body">
      <div class="row g-2 align-items-end">
        <div class="col-md-3">
          <label class="form-label" for="regSelect">Регистратор</label>
          <select id="regSelect" class="form-select"></select>
        </div>
        <div class="col-md-2">
          <label class="form-label" for="dateSelect">Дата</label>
          <select id="dateSelect" class="form-select" disabled></select>
        </div>
        <div class="col-md-2">
          <label class="form-label" for="userSelect">Пользователь</label>
          <select id="userSelect" class="form-select" disabled></select>
        </div>
        <div class="col-md-2">
          <label class="form-label" for="timeSelect">Время</label>
          <select id="timeSelect" class="form-select" disabled></select>
        </div>
        <div class="col-md-2">
          <label class="form-label" for="typeSelect">Тип</label>
          <select id="typeSelect" class="form-select" disabled></select>
        </div>
        <div class="col-md-1 d-grid">
          <button id="btnImportSelected" class="btn btn-primary" disabled>Импорт</button>
        </div>
      </div>
      <div class="mt-3" id="filesList"></div>
    </div>
  </div>

  <div id="registratorFilesTbody"></div>

  <!-- Context menu for registrators page -->
  <div id="registrators-context-menu" class="context-menu d-none">
    <ul class="context-menu__list">
      <li class="context-menu__item" data-action="add">Добавить</li>
      <li class="context-menu__item" data-action="edit">Изменить</li>
      <li class="context-menu__item" data-action="delete">Удалить</li>
    </ul>
  </div>

  <!-- Add Registrator Modal -->
  <div class="modal fade" id="addRegistratorModal" tabindex="-1" aria-labelledby="addRegistratorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addRegistratorModalLabel">Добавить регистратор</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label" for="regAddName">Название</label>
            <input type="text" id="regAddName" class="form-control" />
          </div>
          <div class="mb-3">
            <label class="form-label" for="regAddUrl">Прототип ссылки</label>
            <input type="text" id="regAddUrl" class="form-control" placeholder="https://host/{date}/{user}/{time}/{type}/{file}" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
          <button type="button" class="btn btn-primary" id="regAddSubmit">Добавить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Registrator Modal -->
  <div class="modal fade" id="deleteRegistratorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Удалить регистратор</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          Вы уверены, что хотите удалить регистратор: <strong id="regDelName"></strong>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
          <button type="button" class="btn btn-danger" id="regDelConfirm">Удалить</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script src="{{ url_for('static', filename='js/registrators.js') }}"></script>
{% endblock %}
